---
title: "covidreport"
author: "PANG KAM HING"
date: "2022-08-06"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

COVID-19 has become a global pandemic. Analyzing the patterns can give a deeper understanding of the virus. the report cites Johns Hopkins github site, Importing the time series of COVID-19 case(US and global).

## Library

```{r}
library(tidyverse)
library(tinytex)
library(lubridate)
library(cowplot)
```

## Importing Data

```{r}
URL = 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/'
time_series_covid19_confirmed_US.csv = str_c(URL,'time_series_covid19_confirmed_US.csv')
time_series_covid19_confirmed_global.csv = str_c(URL,'time_series_covid19_confirmed_global.csv')
time_series_covid19_deaths_US.csv = str_c(URL,'time_series_covid19_deaths_US.csv')
time_series_covid19_deaths_global.csv = str_c(URL,'time_series_covid19_deaths_global.csv')
time_series_covid19_recovered_global.csv=str_c(URL,'time_series_covid19_recovered_global.csv')
CUS=read.csv(time_series_covid19_confirmed_US.csv)
CGL=read.csv(time_series_covid19_confirmed_global.csv)
DUS=read.csv(time_series_covid19_deaths_US.csv)
DGL=read.csv(time_series_covid19_deaths_global.csv)
```

## Data cleaning

First,To reduce unnecessary variables, in this report we mainly study the relationship between latitude , case and Case fatality ratio .

```{r}
CUS<-CUS%>%select(-UID,-iso2,-iso3,-code3,-FIPS,-Admin2,-Province_State,-Country_Region)%>%pivot_longer(cols= starts_with('X'),names_to ='Date',values_to = "Case_Number")%>%mutate(Date=as.Date(gsub('X','',Date),format='%m.%d.%y'))
CGL<-CGL%>%pivot_longer(cols= starts_with('X'),names_to ='Date',values_to = "Case_Number")%>%mutate(Date=as.Date(gsub('X','',Date),format='%m.%d.%y'))
DUS<-DUS%>%select(-UID,-iso2,-iso3,-code3,-FIPS,-Admin2,-Province_State)%>%pivot_longer(cols= starts_with('X'),names_to ='Date',values_to = "Case_Number")%>%mutate(Date=as.Date(gsub('X','',Date),format='%m.%d.%y'))
DGL<-DGL%>%pivot_longer(cols= starts_with('X'),names_to ='Date',values_to = "Case_Number")%>%mutate(Date=as.Date(gsub('X','',Date),format='%m.%d.%y'))
```

## Data Transfer for Case Fatality ratio plot

Summarize the US and Global COIVD-19 case by date. In order to avoid too few samples and too many fluctuations in the early stage of the epidemic, we filter the top 10,0000 cases . After this,We citing Case fatality ratio(CFR) by World Health Organization,to create fatality ration by date in US and global. [The World Health Organization states](https://www.who.int/news-room/commentaries/detail/estimating-mortality-from-covid-19)

$$
  Case\ Fatality\  ratio(CFR,in\%) = \frac{Number\ of\ deaths\ from disease}{Number\ of\ comfirmed\ cases \ of\ individuals} \ \times 100 
$$

We would cumulatively use this CFR function.

```{r}
USCASE <-CUS%>%group_by(Date)%>%summarise(US_case=sum(Case_Number))
GLCASE <-CGL%>%group_by(Date)%>%summarise(GL_case=sum(Case_Number))
USDIED<-DUS%>%group_by(Date)%>%summarise(USD_case=sum(Case_Number))
GLDIED<-DGL%>%group_by(Date)%>%summarise(GLD_case=sum(Case_Number))
USCASE<-merge(USDIED,USCASE,by="Date")%>% filter(US_case>100000)
GLCASE<-merge(GLDIED,GLCASE,by="Date")%>%filter(GL_case>100000)
USCFR<-USCASE%>%mutate(US_CFR=USD_case*100/US_case)
GLCFR<-GLCASE%>%mutate(GL_CFR=GLD_case*100/GL_case)
```

## Plotting US and Global case by Date

```{r}
CASE_plot<-ggplot()+geom_line(data=USCASE,aes(Date,US_case,color="US case",))+
  geom_line(data=GLCASE,aes(Date,GL_case,color="Global case"))+
  ylab("Case")+ggtitle("COVID-19 US and Global case")
CRF_plot<-ggplot()+geom_line(data=USCFR,aes(Date,US_CFR,color="US CFR"))+
  geom_line(data=GLCFR,aes(Date,GL_CFR,color="Global CFR"))+ylab("CFR")+ggtitle("COVID-19 Case fatality ratio(CFR)")+scale_y_continuous(limits = c(0, 8))
plot_grid(CASE_plot,CRF_plot,nrow=2)
```

## Tiding Relationship about COVID-19 CFR with latitude in USA

```{r}
LCase <-CUS%>%group_by(Lat)%>%summarise(C_Lat=sum(Case_Number))
LDied<-DUS%>%group_by(Lat)%>%summarise(D_Lat=sum(Case_Number))
LCFR<-merge(LDied,LCase,by="Lat")%>%mutate(L_CFR=D_Lat*100/C_Lat)
```

## Ploting the relationship between CFR with latitude:

```{r}
ggplot(LCFR,aes(Lat,L_CFR,color="US CFR by Latitdue"))+geom_line()
```

## Summarize visualization

After these two visualization are done,we can see first visualization show the US CFR is slightly less than the world then gradually converge.There may be many factors make the CFR under world average,such as medical level, population structure, epidemic prevention policy. And we can see the CFR are significant and sustained decline after 2022-July. This may be related to virus mutation or better response plan for counter COVID-19. According to the second visualization,these data show Latitude and mortality are roughly linearly independent,but be caution this CFR may lower average when latitude over 50, it is probably just a coincidence or partly related temperature, etc.\

## Modeling US CFR

Assuming that the accumulated by date that known cases can be fitted with a polynomial function.we can assume: $$
CFR\approx\frac{Case}{b*Case^{1.5}+a*Case+c} \ \times 100 
$$

```{r}
DATA=mutate(USCFR,input=US_case/1000000)
MODEL <-nls(US_CFR ~100*input/(b*input^1.5+a*input+c),start=list(a=1,b=1,c=1),data=DATA,algorithm ="port" )
ggplot()+geom_line(data=USCFR,aes(Date,US_CFR,color="US CFR"))+geom_line(data=USCASE,aes(Date,fitted(MODEL),color="Fitted function"))
```

```{r}
summary(MODEL)
```

This model are good fitted the CFR.We set the maximum degree of this polynomial to 1.5, which works well. This polynomial hyperparameter may be related to the rate of infection and the ability of the virus to mutate.

## Bias

Firstly,This known COVID-19 cases are not total cases on the world,the known COVID-19 cases are according to local nucleic acid and testing policies.In the early days of the epidemic, there were not enough nucleic acid tests in the world. And now, the rate of voluntary nucleic acid testing may be lower.when died cases better detection,these cases would increase the Case fatality ratio,But it will be overestimated than reality.

Secondly,Testing policies vary around the world,If we get in conclusion about the US CFR is lower the world,then We can not directly say that the true death rate is like this.Because the US testing policies may stricter than other countries,Make the denominator of CFR larger.

## Conclusion
This data shows the statistics of COVID-19 in detail.In this report,We visualized U.S. and world CFR, concluded that U.S. CFR was lower in the upfront period, and believe that latitude does not have a statistically significant relationship with CFR. but we need to summarize more other data such as population, demographics, temperature, policy impact. to prove the connection between these data and reality.

## Reference:

COVID-19 Johns Hopkins github Data source:

## <https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series>

WHO status Case fatality ratio(CFR):

<https://www.who.int/news-room/commentaries/detail/estimating-mortality-from-covid-19>
